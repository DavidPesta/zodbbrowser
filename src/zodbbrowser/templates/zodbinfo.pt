<metal:block metal:use-macro="view/@@zodbbrowser_macros/page">
<metal:block fill-slot="content">

<tal:block define="object view/obj">
  <div class="object">
    <div class="heading">
      <h1 id="path">
        <span class="breadcrumbs" tal:content="structure view/getBreadcrumbs" />
      </h1>
      <h1 id="goto" style="display:none">
        <input type="hidden" id="api" name="api" value="@@zodbbrowser_path_to_oid" />
        <input type="text" class="goto" id="gotoInput" name="goto"
               tal:attributes="value view/getPath"/>
      </h1>
      <span id="pathError" style="display:none"></span>
      <h2 class="type" tal:content="view/getObjectType" />
      <div class="tid-info" tal:condition="not:object/current">
        at <a tal:attributes="href string:#tid${view/getObjectTid}"
              tal:content="view/getObjectTidNice"></a>
        <tal:span tal:content="string:(last change before or at
                                 ${view/getObjectRequestedTidNice})"/>
      </div>
    </div>

    <div class="attributes"
         tal:define="attributes object/listAttributes"
         tal:condition="python:attributes is not None">
      <h3 class="expander">
        <img tal:attributes="src context/++resource++zodbbrowser/collapse.png"
             alt="collapse" />&nbsp;Attributes
      </h3>
      <div class="collapsible">
        <tal:block tal:condition="not:attributes">
          <span class="empty">There are none.</span>
        </tal:block>
        <tal:block tal:repeat="attr attributes">
          <strong tal:content="attr/name" />:
          <tal:block replace="structure attr/rendered_value" />
          <br />
        </tal:block>
      </div>
    </div>

    <div class="items"
         tal:define="items object/listItems"
         tal:condition="python:items is not None">
      <h3 class="expander">
        <img tal:attributes="src context/++resource++zodbbrowser/collapse.png"
             alt="collapse" />&nbsp;Items
      </h3>
      <div class="collapsible">
        <tal:block tal:condition="not:items">
          <span class="empty">There are none.</span>
        </tal:block>
        <tal:block tal:repeat="item items">
          <strong tal:content="item/name" />:
          <tal:block replace="structure item/rendered_value" />
          <br />
        </tal:block>
      </div>
    </div>

    <div class="history"
         tal:define="history object/listHistory"
         tal:condition="history">
      <h3 class="expander">
        <img tal:attributes="src context/++resource++zodbbrowser/collapse.png"
             alt="collapse" />&nbsp;History
      </h3>
      <div class="collapsible">
        <div class="transaction"
             tal:attributes="class python:view.getObjectRequestedTid() and 'transaction' or 'transaction latest'">
          <h4 class="transaction">
            <a tal:attributes="href string:@@zodbbrowser?oid=${view/getObjectId}"
              >Latest</a>
          </h4>
        </div>
        <div class="transaction" tal:repeat="history history"
            tal:attributes="class python:(history['current'] or repeat['history'].start() and not view.getObjectRequestedTid())
                                            and 'transaction current' or 'transaction'">
          <h4 class="transaction" tal:attributes="id string:tid${history/utid}">
            <a tal:attributes="href history/href">
              #<span tal:replace="history/index" />:
              <span tal:content="history/short" />
            </a>
          </h4>
          <div class="diff">
          <tal:block tal:repeat="diff python:sorted(history['diff'].items())">
            <span class="diff"
                  tal:attributes="class python:'diff ' + diff[1][0].split()[0]">
              <strong tal:content="python:diff[0]" />:
              <span tal:content="python:diff[1][0]" />
              <span tal:content="structure python:diff[1][1]" />
            </span> 
            <br />
          </tal:block>
          </div>
        </div>
      </div>
    </div>
  </div>
</tal:block>

<img id="collapseImg" style="display:none" alt=""
     tal:attributes="src context/++resource++zodbbrowser/collapse.png" />
<img id="expandImg" style="display:none" alt=""
     tal:attributes="src context/++resource++zodbbrowser/expand.png" />
</metal:block>
</metal:block>
