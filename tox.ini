[tox]
envlist = py27

[testenv]
passenv =
    PIP_FIND_LINKS
commands =
    zope-testrunner --test-path=src --tests-pattern='^f?tests$' {posargs}
# Install 'persistent' before installing zodbbrowser because *sigh*
# pip install collects the packages to be installed before installing them,
# and some of the packages (BTrees) have a setup_requires=['persistent'], which
# means setuptools will try to download the persistent egg (despite pip already
# having downloaded it), and on Rackspace VMs setuptools downloads over HTTPS
# suffer from mysterious truncation issues that cause md5 hash validation
# problems that break the build.  My hope is that if 'persistent' is already
# installed (not just downloaded) then setup.py egg_info will find it and use
# it instead of attempting to download it again.
# Install ZEO because zodbbrowser depends on ZODB3 which depends on ZEO >=
# 4.0.0dev which tells pip that prereleases are fine, which makes it go and
# download ZEO 5.0.0a2, which is broken on windows, somehow.
deps =
    zope.testrunner
    persistent
    ZEO

[testenv:py]
commands =
    python --version
    zope-testrunner --test-path=src --tests-pattern='^f?tests$' {posargs}

[testenv:coverage]
basepython = python2.7
commands =
    coverage run -m zope.testrunner --test-path=src --tests-pattern='^f?tests$'
    coverage report
usedevelop = true
deps =
    coverage
    {[testenv]deps}
